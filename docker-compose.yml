version: "3.8"

services:
  goaccess:
    image: allinurl/goaccess:latest
    container_name: goaccess
    user: root
    entrypoint: ["sh", "/startup.sh"]
    volumes:
      - ${GOACCESS_DB_DIR:-./data/db}:/opt/goaccess/db
      - ${GOACCESS_HTML_DIR:-./data/html}:/var/www/html
      - ${NGX_LOG_DIR:-/var/log/nginx}:/logs:ro
      - ./goaccess/goaccess.conf:/etc/goaccess/goaccess.conf:ro
      - ./goaccess/startup.sh:/startup.sh:ro
    ports:
      - "${WS_PORT:-7890}:7890"
    restart: unless-stopped

  web:
    image: caddy:2-alpine
    container_name: goaccess-web
    ports:
      - "${DASHBOARD_PORT:-8080}:80"
    volumes:
      - ${GOACCESS_HTML_DIR:-./data/html}:/usr/share/caddy
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
    restart: unless-stopped
